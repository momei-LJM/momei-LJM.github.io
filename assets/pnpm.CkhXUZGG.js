import{_ as k}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BsbR9aO8.js";import"./chunks/@vueuse/motion.Dn1GpBEi.js";import{e as h,a as c,u as b}from"./chunks/vue-router.DVH0lrmO.js";import{aa as f,ap as s,ag as t,af as l,ae as y,ai as n,O as v,ab as x,a1 as E}from"./framework.CGu8yplz.js";import"./app.Chb1CK_a.js";import"./chunks/dayjs.Byk5cVHE.js";import"./chunks/vue-i18n.DVKTYa6R.js";import"./chunks/pinia.DlZ7VN09.js";/* empty css                    */import"./chunks/nprogress.Cino7761.js";import"./YunComment.vue_vue_type_style_index_0_lang.DPuW02hO.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.lP4g-Y-T.js";import"./post.dLNIdytl.js";const C=h("/posts/pnpm",async i=>JSON.parse('{"title":"pnpm&monorepo","description":"","frontmatter":{"title":"pnpm&monorepo","date":"2025-3-23","updated":"2025-3-23","categories":"前端小记","excerpt_type":"html","tags":["光神笔记"],"top":1},"headers":[],"relativePath":"pages/posts/pnpm.md","lastUpdated":1752730450000}'),{lazy:(i,o)=>i.name===o.name}),S={__name:"pnpm",setup(i,{expose:o}){var d;const{data:r}=C(),u=b(),m=c(),p=Object.assign(m.meta.frontmatter||{},((d=r.value)==null?void 0:d.frontmatter)||{});return u.currentRoute.value.data=r.value,E("valaxy:frontmatter",p),globalThis.$frontmatter=p,o({frontmatter:{title:"pnpm&monorepo",date:"2025-3-23",updated:"2025-3-23",categories:"前端小记",excerpt_type:"html",tags:["光神笔记"],top:1}}),(e,a)=>{const g=k;return x(),f(g,{frontmatter:v(p)},{"main-content-md":s(()=>[a[0]||(a[0]=l("h3",{id:"大纲",tabindex:"-1"},[n("大纲 "),l("a",{class:"header-anchor",href:"#大纲","aria-label":'Permalink to "大纲"'},"​")],-1)),a[1]||(a[1]=l("img",{style:{width:"150px"},src:"https://images.seeklogo.com/logo-png/43/1/pnpm-logo-png_seeklogo-430956.png"},null,-1)),a[2]||(a[2]=l("ul",null,[l("li",null,"pnpm 特点（幽灵依赖，磁盘复用，软硬链接）"),l("li",null,"workspace"),l("li",null,"changeset"),l("li",null,"monorepo 打包"),l("li",null,"catalog"),l("li",null,"常用命令")],-1)),y(" more "),a[3]||(a[3]=l("h3",{id:"pnpm-特点",tabindex:"-1"},[n("pnpm 特点 "),l("a",{class:"header-anchor",href:"#pnpm-特点","aria-label":'Permalink to "pnpm 特点"'},"​")],-1)),a[4]||(a[4]=l("p",null,"pnpm 解决的问题：",-1)),a[5]||(a[5]=l("h4",{id:"幽灵依赖",tabindex:"-1"},[n("幽灵依赖 "),l("a",{class:"header-anchor",href:"#幽灵依赖","aria-label":'Permalink to "幽灵依赖"'},"​")],-1)),a[6]||(a[6]=l("p",null,[n("为了实现依赖包的复用，现代包管理器比如"),l("code",null,"npm"),n("或者"),l("code",null,"yarn"),n(" 会将依赖扁平化到"),l("code",null,"node_modules"),n("目录下,这样实现了依赖复用，即相同的包只安装一次；但同时也引入了新的问题：项目可以使用本项目依赖以外的其他依赖，俗称幽灵依赖。 问题：如果某天依赖不在使用，项目就会报错。 解决：pnpm 将项目依赖提升至外层node_modules，其余依赖在具体项目中使用软链接 指向.pnpm 中的依赖")],-1)),a[7]||(a[7]=l("h4",{id:"磁盘复用",tabindex:"-1"},[n("磁盘复用 "),l("a",{class:"header-anchor",href:"#磁盘复用","aria-label":'Permalink to "磁盘复用"'},"​")],-1)),a[8]||(a[8]=l("p",null,[l("code",null,"npm"),n("只能每次install都会重复下载，浪费了磁盘； "),l("code",null,"pnpm"),n("有一个全局store，存储所有的用户依赖；项目中通过硬链接访问store中的依赖，不会重复下载。")],-1)),a[9]||(a[9]=l("h4",{id:"软硬链接",tabindex:"-1"},[n("软硬链接 "),l("a",{class:"header-anchor",href:"#软硬链接","aria-label":'Permalink to "软硬链接"'},"​")],-1)),a[10]||(a[10]=l("p",null,"软链接，类似快捷方式，是一个可读的文件，内容指向源文件 硬链接，直接链接源文件； 使用起来没什么区别",-1)),a[11]||(a[11]=l("h3",{id:"workspace",tabindex:"-1"},[n("workspace "),l("a",{class:"header-anchor",href:"#workspace","aria-label":'Permalink to "workspace"'},"​")],-1)),a[12]||(a[12]=l("p",null,[l("span",{class:"text-red"},"先抛问题：monorepo解决什么问题？")],-1)),a[13]||(a[13]=l("ul",null,[l("li",null,[l("span",{class:"text-amber"},"如果一个单体项目，同时联调多个 package ,每次都 link 吗？")]),l("li",null,[l("span",{class:"text-amber"},"如果多个单体项目，linter，format, tsconfig，build都是一样的，每次都cv安装吗？")]),l("li",null,[l("span",{class:"text-amber"},"如果构建流对依赖是有顺序要求的，手动维护吗？")])],-1)),a[14]||(a[14]=l("p",null,[n("一般在使用"),l("code",null,"monorepo"),n("的时候，会使用 "),l("code",null,"workspace"),n("功能；")],-1)),a[15]||(a[15]=l("div",{class:"language-"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"}),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",null,"packages/")]),n(`
`),l("span",{class:"line"},[l("span",null,"|-package1")]),n(`
`),l("span",{class:"line"},[l("span",null,"|-package2")])])]),l("button",{class:"collapse"})],-1)),a[16]||(a[16]=l("div",{class:"language-yaml"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"yaml"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# pnpm-workspace.yaml")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"packages"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"packages/*"')])])]),l("button",{class:"collapse"})],-1)),a[17]||(a[17]=l("ol",null,[l("li",null,[n("调试："),l("code",null,"pnpm --filter package2 i package1 --workspace"),n(";直接安装工作空间的依赖")]),l("li",null,[n("把通用依赖安装到根目录："),l("code",null,"pnpm i xxx -w"),n(";")])],-1)),a[18]||(a[18]=l("blockquote",null,[l("p",null,[l("code",null,"-w --workspace-root"),n(" 指安装到根目录, "),l("code",null,"--workspace"),n(" 指从工作空间安装")])],-1)),a[19]||(a[19]=l("blockquote",null,[l("p",null,[n("通用依赖指的是不参与发包的依赖，才可以 "),l("code",null,"-w"),n("，参与发包的任然需要安装到具体项目")])],-1)),a[20]||(a[20]=l("ol",{start:"3"},[l("li",null,"构建：可以编写统一脚本，如：``pnpm -C packagea run build&& pnpm -C packageb run build`;")],-1)),a[21]||(a[21]=l("h3",{id:"changeset",tabindex:"-1"},[l("a",{href:"https://github.com/changesets/changesets/blob/main/docs/command-line-options.md",target:"_blank",rel:"noreferrer"},"changeset"),n(),l("a",{class:"header-anchor",href:"#changeset","aria-label":'Permalink to "[changeset](https://github.com/changesets/changesets/blob/main/docs/command-line-options.md)"'},"​")],-1)),a[22]||(a[22]=l("p",null,"changeset 是一个用于管理 monorepo 中的版本控制工具，它允许你为每个包单独管理版本，并生成一个 CHANGELOG.md 文件，用于记录每个包的更新内容。",-1)),a[23]||(a[23]=l("div",{class:"language-shell"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"shell"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"pnpm"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," add"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -DW"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," @changesets/cli")])])]),l("button",{class:"collapse"})],-1)),a[24]||(a[24]=l("ol",null,[l("li",null,[n("初始化："),l("code",null,"npx changeset init"),n(";")]),l("li",null,[n("添加包："),l("code",null,"npx changeset add"),n(";会让选择包含的包生成 "),l("code",null,"changelog")]),l("li",null,[n("更新版本："),l("code",null,"npx changeset version"),n(";会让选择包更新版本 "),l("code",null,"major"),n(),l("code",null,"minor"),n(),l("code",null,"patch")]),l("li",null,[n("发布："),l("code",null,"npx changeset publish"),n(";")])],-1)),a[25]||(a[25]=l("h3",{id:"catalog",tabindex:"-1"},[n("catalog "),l("a",{class:"header-anchor",href:"#catalog","aria-label":'Permalink to "catalog"'},"​")],-1)),a[26]||(a[26]=l("p",null,"catalog 可以统一项目依赖版本号",-1)),a[27]||(a[27]=l("div",{class:"language-ymal"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"ymal"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",null,"# pnpm-workspace.yaml")]),n(`
`),l("span",{class:"line"},[l("span",null,"packages:")]),n(`
`),l("span",{class:"line"},[l("span",null,'  - "packages/*"')]),n(`
`),l("span",{class:"line"},[l("span",null,"catalog:")]),n(`
`),l("span",{class:"line"},[l("span",null,"  react: ^16.14.0")])])]),l("button",{class:"collapse"})],-1)),a[28]||(a[28]=l("div",{class:"language-json"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"json"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "devDependencies"'),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'    "react"'),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"catalog:"')]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  },")])])]),l("button",{class:"collapse"})],-1)),a[29]||(a[29]=l("p",null,"发布后会使用catalog的具体版本号",-1)),a[30]||(a[30]=l("h3",{id:"常用命令",tabindex:"-1"},[n("常用命令 "),l("a",{class:"header-anchor",href:"#常用命令","aria-label":'Permalink to "常用命令"'},"​")],-1)),a[31]||(a[31]=l("ol",null,[l("li",null,[l("code",null,"pnpm i -w"),n(" 安装到根目录;")]),l("li",null,[l("code",null,"pnpm i --filter package1"),n(" 安装到工作空间中指定的包;")]),l("li",null,[l("code",null,"pnpm -C run xxx"),n(" 指定 到具体包执行 npm scripts ;")]),l("li",null,[l("code",null,"pnpm --filter exec npx xxx"),n(" 指定到具体包执行 命令 ;")]),l("li",null,[l("code",null,"pnpm -r exec xxx"),n(" 递归每一个目录执行命令 ;")]),l("li",null,[l("code",null,"changeset init"),n(" 初始化 changeset;")]),l("li",null,[l("code",null,"changeset add"),n(" 添加包;")]),l("li",null,[l("code",null,"changeset version"),n(" 更新版本;")]),l("li",null,[l("code",null,"changeset publish"),n(" 发布;")])],-1))]),"main-header":s(()=>[t(e.$slots,"main-header")]),"main-header-after":s(()=>[t(e.$slots,"main-header-after")]),"main-nav":s(()=>[t(e.$slots,"main-nav")]),"main-content-before":s(()=>[t(e.$slots,"main-content-before")]),"main-content":s(()=>[t(e.$slots,"main-content")]),"main-content-after":s(()=>[t(e.$slots,"main-content-after")]),"main-nav-before":s(()=>[t(e.$slots,"main-nav-before")]),"main-nav-after":s(()=>[t(e.$slots,"main-nav-after")]),comment:s(()=>[t(e.$slots,"comment")]),footer:s(()=>[t(e.$slots,"footer")]),aside:s(()=>[t(e.$slots,"aside")]),"aside-custom":s(()=>[t(e.$slots,"aside-custom")]),default:s(()=>[t(e.$slots,"default")]),_:3},8,["frontmatter"])}}};export{S as default,C as usePageData};
