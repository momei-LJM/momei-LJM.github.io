import{_ as k}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BPbYAKLR.js";import{f as h,a as c,u as b}from"./chunks/vue-router.DrOY150l.js";import{O as f,a4 as n,V as t,U as l,S as v,X as a,u as y,P as x,D as E}from"./framework.BEq2kmef.js";import"./app.Qn9L7bXp.js";import"./chunks/dayjs.CCYrSalk.js";import"./chunks/vue-i18n.CcQElOXT.js";import"./chunks/@vueuse/motion.D4Qo28V0.js";import"./chunks/pinia.CkeLaQKW.js";import"./chunks/nprogress.BahbDzmd.js";import"./YunComment.vue_vue_type_style_index_0_lang.Cf8baqkz.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.D-ItBhze.js";import"./post.B2klRnYW.js";const C=h("/posts/pnpm",async o=>JSON.parse('{"title":"pnpm&monorepo","description":"","frontmatter":{"title":"pnpm&monorepo","date":"2025-3-23","updated":"2025-3-23","categories":"前端小记","excerpt_type":"html","tags":["光神笔记"],"top":1},"headers":[{"level":3,"title":"大纲","slug":"大纲","link":"#大纲","children":[]},{"level":3,"title":"pnpm 特点","slug":"pnpm-特点","link":"#pnpm-特点","children":[]},{"level":3,"title":"workspace","slug":"workspace","link":"#workspace","children":[]},{"level":3,"title":"changeset","slug":"changeset","link":"#changeset","children":[]},{"level":3,"title":"catalog","slug":"catalog","link":"#catalog","children":[]},{"level":3,"title":"常用命令","slug":"常用命令","link":"#常用命令","children":[]}],"relativePath":"pages/posts/pnpm.md","lastUpdated":1751450878000}'),{lazy:(o,p)=>o.name===p.name}),G={__name:"pnpm",setup(o,{expose:p}){var u;const{data:r}=C(),m=b(),d=c(),i=Object.assign(d.meta.frontmatter||{},((u=r.value)==null?void 0:u.frontmatter)||{});return d.meta.frontmatter=i,m.currentRoute.value.data=r.value,E("valaxy:frontmatter",i),globalThis.$frontmatter=i,p({frontmatter:{title:"pnpm&monorepo",date:"2025-3-23",updated:"2025-3-23",categories:"前端小记",excerpt_type:"html",tags:["光神笔记"],top:1}}),(s,e)=>{const g=k;return x(),f(g,{frontmatter:y(i)},{"main-content-md":n(()=>[e[0]||(e[0]=l("h3",{id:"大纲",tabindex:"-1"},[a("大纲 "),l("a",{class:"header-anchor",href:"#大纲","aria-label":'Permalink to "大纲"'},"​")],-1)),e[1]||(e[1]=l("img",{style:{width:"150px"},src:"https://images.seeklogo.com/logo-png/43/1/pnpm-logo-png_seeklogo-430956.png"},null,-1)),e[2]||(e[2]=l("ul",null,[l("li",null,"pnpm 特点（幽灵依赖，磁盘复用，软硬链接）"),l("li",null,"workspace"),l("li",null,"changeset"),l("li",null,"monorepo 打包"),l("li",null,"catalog"),l("li",null,"常用命令")],-1)),v(" more "),e[3]||(e[3]=l("h3",{id:"pnpm-特点",tabindex:"-1"},[a("pnpm 特点 "),l("a",{class:"header-anchor",href:"#pnpm-特点","aria-label":'Permalink to "pnpm 特点"'},"​")],-1)),e[4]||(e[4]=l("p",null,"pnpm 解决的问题：",-1)),e[5]||(e[5]=l("h4",{id:"幽灵依赖",tabindex:"-1"},[a("幽灵依赖 "),l("a",{class:"header-anchor",href:"#幽灵依赖","aria-label":'Permalink to "幽灵依赖"'},"​")],-1)),e[6]||(e[6]=l("p",null,[a("为了实现依赖包的复用，现代包管理器比如"),l("code",null,"npm"),a("或者"),l("code",null,"yarn"),a(" 会将依赖扁平化到"),l("code",null,"node_modules"),a("目录下,这样实现了依赖复用，即相同的包只安装一次；但同时也引入了新的问题：项目可以使用本项目依赖以外的其他依赖，俗称幽灵依赖。 问题：如果某天依赖不在使用，项目就会报错。 解决：pnpm 将项目依赖提升至外层node_modules，其余依赖在具体项目中使用软链接 指向.pnpm 中的依赖")],-1)),e[7]||(e[7]=l("h4",{id:"磁盘复用",tabindex:"-1"},[a("磁盘复用 "),l("a",{class:"header-anchor",href:"#磁盘复用","aria-label":'Permalink to "磁盘复用"'},"​")],-1)),e[8]||(e[8]=l("p",null,[l("code",null,"npm"),a("只能每次install都会重复下载，浪费了磁盘； "),l("code",null,"pnpm"),a("有一个全局store，存储所有的用户依赖；项目中通过硬链接访问store中的依赖，不会重复下载。")],-1)),e[9]||(e[9]=l("h4",{id:"软硬链接",tabindex:"-1"},[a("软硬链接 "),l("a",{class:"header-anchor",href:"#软硬链接","aria-label":'Permalink to "软硬链接"'},"​")],-1)),e[10]||(e[10]=l("p",null,"软链接，类似快捷方式，是一个可读的文件，内容指向源文件 硬链接，直接链接源文件； 使用起来没什么区别",-1)),e[11]||(e[11]=l("h3",{id:"workspace",tabindex:"-1"},[a("workspace "),l("a",{class:"header-anchor",href:"#workspace","aria-label":'Permalink to "workspace"'},"​")],-1)),e[12]||(e[12]=l("p",null,[l("span",{class:"text-red"},"先抛问题：monorepo解决什么问题？")],-1)),e[13]||(e[13]=l("ul",null,[l("li",null,[l("span",{class:"text-amber"},"如果一个单体项目，同时联调多个 package ,每次都 link 吗？")]),l("li",null,[l("span",{class:"text-amber"},"如果多个单体项目，linter，format, tsconfig，build都是一样的，每次都cv安装吗？")]),l("li",null,[l("span",{class:"text-amber"},"如果构建流对依赖是有顺序要求的，手动维护吗？")])],-1)),e[14]||(e[14]=l("p",null,[a("一般在使用"),l("code",null,"monorepo"),a("的时候，会使用 "),l("code",null,"workspace"),a("功能；")],-1)),e[15]||(e[15]=l("div",{class:"language- vp-adaptive-theme"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"}),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",null,"packages/")]),a(`
`),l("span",{class:"line"},[l("span",null,"|-package1")]),a(`
`),l("span",{class:"line"},[l("span",null,"|-package2")])])]),l("button",{class:"collapse"})],-1)),e[16]||(e[16]=l("div",{class:"language-yaml vp-adaptive-theme"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"},"yaml"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# pnpm-workspace.yaml")]),a(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"packages"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),a(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"packages/*"')])])]),l("button",{class:"collapse"})],-1)),e[17]||(e[17]=l("ol",null,[l("li",null,[a("调试："),l("code",null,"pnpm --filter package2 i package1 --workspace"),a(";直接安装工作空间的依赖")]),l("li",null,[a("把通用依赖安装到根目录："),l("code",null,"pnpm i xxx -w"),a(";")])],-1)),e[18]||(e[18]=l("blockquote",null,[l("p",null,[l("code",null,"-w --workspace-root"),a(" 指安装到根目录, "),l("code",null,"--workspace"),a(" 指从工作空间安装")])],-1)),e[19]||(e[19]=l("blockquote",null,[l("p",null,[a("通用依赖指的是不参与发包的依赖，才可以 "),l("code",null,"-w"),a("，参与发包的任然需要安装到具体项目")])],-1)),e[20]||(e[20]=l("ol",{start:"3"},[l("li",null,"构建：可以编写统一脚本，如：``pnpm -C packagea run build&& pnpm -C packageb run build`;")],-1)),e[21]||(e[21]=l("h3",{id:"changeset",tabindex:"-1"},[l("a",{href:"https://github.com/changesets/changesets/blob/main/docs/command-line-options.md",target:"_blank",rel:"noreferrer"},"changeset"),a(),l("a",{class:"header-anchor",href:"#changeset","aria-label":'Permalink to "[changeset](https://github.com/changesets/changesets/blob/main/docs/command-line-options.md)"'},"​")],-1)),e[22]||(e[22]=l("p",null,"changeset 是一个用于管理 monorepo 中的版本控制工具，它允许你为每个包单独管理版本，并生成一个 CHANGELOG.md 文件，用于记录每个包的更新内容。",-1)),e[23]||(e[23]=l("div",{class:"language-shell vp-adaptive-theme"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"},"shell"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"pnpm"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," add"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -DW"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," @changesets/cli")])])]),l("button",{class:"collapse"})],-1)),e[24]||(e[24]=l("ol",null,[l("li",null,[a("初始化："),l("code",null,"npx changeset init"),a(";")]),l("li",null,[a("添加包："),l("code",null,"npx changeset add"),a(";会让选择包含的包生成 "),l("code",null,"changelog")]),l("li",null,[a("更新版本："),l("code",null,"npx changeset version"),a(";会让选择包更新版本 "),l("code",null,"major"),a(),l("code",null,"minor"),a(),l("code",null,"patch")]),l("li",null,[a("发布："),l("code",null,"npx changeset publish"),a(";")])],-1)),e[25]||(e[25]=l("h3",{id:"catalog",tabindex:"-1"},[a("catalog "),l("a",{class:"header-anchor",href:"#catalog","aria-label":'Permalink to "catalog"'},"​")],-1)),e[26]||(e[26]=l("p",null,"catalog 可以统一项目依赖版本号",-1)),e[27]||(e[27]=l("div",{class:"language-ymal vp-adaptive-theme"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"},"ymal"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",null,"# pnpm-workspace.yaml")]),a(`
`),l("span",{class:"line"},[l("span",null,"packages:")]),a(`
`),l("span",{class:"line"},[l("span",null,'  - "packages/*"')]),a(`
`),l("span",{class:"line"},[l("span",null,"catalog:")]),a(`
`),l("span",{class:"line"},[l("span",null,"  react: ^16.14.0")])])]),l("button",{class:"collapse"})],-1)),e[28]||(e[28]=l("div",{class:"language-json vp-adaptive-theme"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"},"json"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "devDependencies"'),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {")]),a(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'    "react"'),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"catalog:"')]),a(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  },")])])]),l("button",{class:"collapse"})],-1)),e[29]||(e[29]=l("p",null,"发布后会使用catalog的具体版本号",-1)),e[30]||(e[30]=l("h3",{id:"常用命令",tabindex:"-1"},[a("常用命令 "),l("a",{class:"header-anchor",href:"#常用命令","aria-label":'Permalink to "常用命令"'},"​")],-1)),e[31]||(e[31]=l("ol",null,[l("li",null,[l("code",null,"pnpm i -w"),a(" 安装到根目录;")]),l("li",null,[l("code",null,"pnpm i --filter package1"),a(" 安装到工作空间中指定的包;")]),l("li",null,[l("code",null,"pnpm -C run xxx"),a(" 指定 到具体包执行 npm scripts ;")]),l("li",null,[l("code",null,"pnpm --filter exec npx xxx"),a(" 指定到具体包执行 命令 ;")]),l("li",null,[l("code",null,"pnpm -r exec xxx"),a(" 递归每一个目录执行命令 ;")]),l("li",null,[l("code",null,"changeset init"),a(" 初始化 changeset;")]),l("li",null,[l("code",null,"changeset add"),a(" 添加包;")]),l("li",null,[l("code",null,"changeset version"),a(" 更新版本;")]),l("li",null,[l("code",null,"changeset publish"),a(" 发布;")])],-1))]),"main-header":n(()=>[t(s.$slots,"main-header")]),"main-header-after":n(()=>[t(s.$slots,"main-header-after")]),"main-nav":n(()=>[t(s.$slots,"main-nav")]),"main-content-before":n(()=>[t(s.$slots,"main-content-before")]),"main-content":n(()=>[t(s.$slots,"main-content")]),"main-content-after":n(()=>[t(s.$slots,"main-content-after")]),"main-nav-before":n(()=>[t(s.$slots,"main-nav-before")]),"main-nav-after":n(()=>[t(s.$slots,"main-nav-after")]),comment:n(()=>[t(s.$slots,"comment")]),footer:n(()=>[t(s.$slots,"footer")]),aside:n(()=>[t(s.$slots,"aside")]),"aside-custom":n(()=>[t(s.$slots,"aside-custom")]),default:n(()=>[t(s.$slots,"default")]),_:3},8,["frontmatter"])}}};export{G as default,C as usePageData};
